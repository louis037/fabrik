/*! Fabrik */

define(["jquery","fab/fabrik"],function(o,a){"use strict";return new Class({initialize:function(t,i){this.form=t,this.options={liveSite:""},this.options=o.extend(this.options,i);var s=this.form.getForm(),e=this.form.id;this.pkfield=s.getElement("input[name=rowid]"),this.view=!0===this.form.options.editable?"form":"details",this.url=this.options.liveSite+"index.php?option=com_fabrik&format=raw&view=plugin&g=form&task=pluginAjax&plugin=paginate&method=xRecord&formid="+e+"&mode="+this.options.view+"&rowid=",this.watchButtons()},doUpdate:function(t){var s,e=JSON.parse(t),o="form"===this.view?e.data:e.html;this.options.ids=e.ids,this.form.formElements.each(function(i,t){if("_ro"!==t.substr(-3)){s=o[t];try{"null"!==typeOf(s)?i.updateUsingRaw()?i.update(e.data[t]):"form"===this.view?i.update(s):i.update(Encoder.htmlDecode(s)):i.update("")}catch(t){console.log(i,s,t)}}}.bind(this)),"form"===this.view&&(this.pkfield.value=o[this.options.pkey]),this.form.options.rowid=e.data[this.options.pkey],this.reScan(),window.fireEvent("fabrik.form.refresh",[e.post.rowid]),a.loader.stop(this.form.getBlock())},reScan:function(){"undefined"!=typeof Slimbox&&Slimbox.scanPage(),"undefined"!=typeof Lightbox&&Lightbox.init(),"undefined"!=typeof Mediabox&&Mediabox.scanPage(),this.form.getForm().getElements("*[data-paginate]").each(function(t){switch(t.get("data-paginate")){case"first":case"prev":0===this.options.ids.index?t.addClass("active"):t.removeClass("active");break;case"next":case"last":this.options.ids.index===this.options.ids.lastKey?t.addClass("active"):t.removeClass("active")}}.bind(this))},doNav:function(t){var i,s=!0;switch(t.get("data-paginate")){case"first":0===this.options.ids.index&&(s=!1),i=this.options.ids.first;break;case"last":this.options.ids.index===this.options.ids.lastKey&&(s=!1),i=this.options.ids.last;break;case"prev":0===this.options.ids.index&&(s=!1),i=this.options.ids.prev;break;case"next":this.options.ids.index===this.options.ids.lastKey&&(s=!1),i=this.options.ids.next}s&&(a.loader.start(this.form.getBlock()),new Request({url:this.url+i,evalScripts:!0,onComplete:function(t){this.doUpdate(t)}.bind(this)}).send())},watchButtons:function(){this.form.getForm().addEvent("click:relay(*[data-paginate])",function(t,i){t.preventDefault(),this.doNav(i)}.bind(this))}})});